{% extends "base.html" %}

{% block title %}Login - Medical Records System{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
    
    <form id="loginForm" class="space-y-4">
        <div>
            <label class="block text-gray-700">Username</label>
            <input type="text" name="username" id="username" class="w-full p-2 border rounded">
        </div>
        
        <div>
            <label class="block text-gray-700">Password</label>
            <input type="password" name="password" id="password" class="w-full p-2 border rounded">
        </div>
        
        <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
            Login
        </button>
    </form>
</div>

<script>
    $('#loginForm').on('submit', function(e) {
        e.preventDefault();
        
        // Vulnerable direct JSON submission
        const data = {
            username: $('#username').val(),
            password: $('#password').val()
        };
        
        // Vulnerable authentication handling
        $.ajax({
            url: '/api/auth/login',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                // Vulnerable token storage
                localStorage.setItem('token', response.token);
                localStorage.setItem('userRole', response.role);
                localStorage.setItem('userId', response.user_id);
                window.location.href = '/patients';
            },
            error: function() {
                alert('Login failed');
            }
        });
    });
</script>
{% endblock %}